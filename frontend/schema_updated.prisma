generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                Int                @id @default(autoincrement())
  email             String             @unique
  isMentorApproved  Boolean            @default(false)  // Changed to false, requires verification to become mentor
  createdAt         DateTime           @default(now())
  passwordHash      String
  updatedAt         DateTime           @updatedAt       // Changed to @updatedAt for automatic updates
  role              Role               @default(mentee)
  availabilitySlots AvailabilitySlot[]
  menteeBookings    Booking[]          @relation("MenteeBookings")
  mentorBookings    Booking[]          @relation("MentorBookings")
  mentorRequests    MentorRequest[]
  mentorSkills      MentorSkill[]
  notifications     Notification[]
  profile           UserProfile?
  mentorProfile     MentorProfile?     // New: Mentor-specific profile
  education         Education[]        // New education background relationship
}

// Extended basic user profile
model UserProfile {
  userId             Int     @id
  fullName           String
  bio                String?
  location           String?
  profileImageUrl    String?
  linkedinUrl        String?
  websiteUrl         String?
  // New fields to match frontend
  professionalTitle  String?
  company            String?
  phone              String?
  socialMedia        String?
  expertise          String?  // Stored as JSON string
  user               User    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

// New: Mentor-specific detailed profile
model MentorProfile {
  userId            Int      @id
  currentTitle      String?
  company           String?
  experience        String?  // Years of work experience
  industry          String?
  university        String?
  degree            String?
  major             String?
  mentorshipAreas   String?  // Stored as JSON string
  isVerified        Boolean  @default(false)
  verifiedAt        DateTime?
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

// Extended mentor application form
model MentorRequest {
  id                 Int           @id @default(autoincrement())
  userId             Int
  // Basic information
  fullName           String
  phone              String
  linkedinUrl        String?
  // Professional information
  currentTitle       String
  company            String
  experience         String
  industry           String
  expertise          String        // JSON string to store skills array
  // Educational background
  university         String?
  degree             String?
  major              String?
  // Mentoring information
  bio                String
  mentorshipAreas    String        // JSON string to store mentorship areas array
  // Documents
  identityDocumentUrl String?
  workDocumentUrl     String?
  // Status and timestamps
  status             RequestStatus @default(pending)
  submittedAt        DateTime      @default(now())
  reviewedAt         DateTime?
  reviewNotes        String?       // Review notes
  user               User          @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model MentorSkill {
  id        Int    @id @default(autoincrement())
  mentorId  Int
  skillName String
  level     String? // Skill level: beginner, intermediate, advanced, expert
  mentor    User   @relation(fields: [mentorId], references: [id], onDelete: Cascade)
}

model AvailabilitySlot {
  id        Int       @id @default(autoincrement())
  mentorId  Int
  startTime DateTime
  endTime   DateTime
  isBooked  Boolean   @default(false)
  title     String?   // Time slot title
  mentor    User      @relation(fields: [mentorId], references: [id], onDelete: Cascade)
  booking   Booking[]
}

// Extended booking table to match frontend
model Booking {
  id                 Int               @id @default(autoincrement())
  topic              String            // Corresponds to frontend title
  description        String?           // Meeting description
  availabilitySlotId Int?
  createdAt          DateTime          @default(now())
  updatedAt          DateTime          @updatedAt
  locationDetails    String?           // Corresponds to frontend address
  locationType       LocationType
  menteeId           Int
  mentorId           Int
  status             BookingStatus     @default(pending)
  // New fields
  duration           String?           // Meeting duration
  maxParticipants    Int?              // Maximum number of participants
  currentParticipants Int              @default(1)  // Current number of participants
  notes              String?           // Additional notes
  meetingDate        DateTime?         // Specific meeting date and time
  availabilitySlot   AvailabilitySlot? @relation(fields: [availabilitySlotId], references: [id])
  mentee             User              @relation("MenteeBookings", fields: [menteeId], references: [id], onDelete: Cascade)
  mentor             User              @relation("MentorBookings", fields: [mentorId], references: [id], onDelete: Cascade)
}

// New: User education background table
model Education {
  id         Int    @id @default(autoincrement())
  userId     Int
  university String
  degree     String
  period     String
  skills     String // JSON string to store skills array
  logoUrl    String?
  user       User   @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Notification {
  id        Int      @id @default(autoincrement())
  userId    Int
  title     String?  // Notification title
  message   String
  type      String?  // Notification type: booking, verification, system, etc.
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

enum Role {
  mentee
  mentor
  admin    // New admin role
}

// Extended request status
enum RequestStatus {
  pending
  approved
  rejected
  under_review  // New under review status
}

// Modified booking status to match frontend
enum BookingStatus {
  pending
  accepted     // Changed from confirmed to match frontend Accepted
  rejected
  cancelled
  completed    // New completed status
}

enum LocationType {
  online
  in_person
}

// New: Skill level enum
enum SkillLevel {
  beginner
  intermediate
  advanced
  expert
}

// New: Notification type enum
enum NotificationType {
  booking
  verification
  system
  reminder
}



// Summary of major changes:
// 1. Extended UserProfile table, added fields used by frontend
// 2. Added MentorProfile table to store mentor-specific information
// 3. Significantly extended MentorRequest table, including all verification form fields
// 4. Extended Booking table, added fields used by frontend CreateMeetingModal
// 5. Added Education table to store user educational background
// 6. Modified enum values to match frontend status
// 7. Added more useful fields such as review notes, notification types, etc.
// 8. Improved timestamp fields using @updatedAt for automatic updates