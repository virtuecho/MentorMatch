// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                Int              @id @default(autoincrement())
  email             String           @unique
  passwordHash      String
  role              Role             @default(mentee)
  isMentorApproved  Boolean          @default(false)
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @default(now())
  profile           UserProfile?
  mentorRequests    MentorRequest[]
  mentorSkills      MentorSkill[]
  availabilitySlots AvailabilitySlot[]
  menteeBookings    Booking[]        @relation("MenteeBookings")
  mentorBookings    Booking[]        @relation("MentorBookings")
  notifications     Notification[]
}

model UserProfile {
  userId         Int      @id
  fullName       String
  bio            String?
  location       String?
  profileImageUrl String?
  linkedinUrl    String?
  websiteUrl     String?
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model MentorRequest {
  id          Int      @id @default(autoincrement())
  userId      Int
  documentUrl String
  status      RequestStatus @default(pending)
  submittedAt DateTime @default(now())
  reviewedAt  DateTime?
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model MentorSkill {
  id        Int    @id @default(autoincrement())
  mentorId  Int
  skillName String
  mentor    User   @relation(fields: [mentorId], references: [id], onDelete: Cascade)
}

model AvailabilitySlot {
  id        Int      @id @default(autoincrement())
  mentorId  Int
  startTime DateTime
  endTime   DateTime
  isBooked  Boolean  @default(false)
  mentor    User     @relation(fields: [mentorId], references: [id], onDelete: Cascade)
  booking   Booking[]
}

model Booking {
  id                  Int      @id @default(autoincrement())
  mentorId            Int
  menteeId            Int
  availabilitySlotId  Int?
  topic               String
  locationType        LocationType
  locationDetails     String?
  status              BookingStatus @default(pending)
  createdAt           DateTime @default(now())
  mentor              User     @relation("MentorBookings", fields: [mentorId], references: [id], onDelete: Cascade)
  mentee              User     @relation("MenteeBookings", fields: [menteeId], references: [id], onDelete: Cascade)
  availabilitySlot   AvailabilitySlot? @relation(fields: [availabilitySlotId], references: [id], onDelete: SetNull)
}

model Notification {
  id        Int      @id @default(autoincrement())
  userId    Int
  message   String
  isRead    Boolean  @default(false)
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

enum Role {
  mentee
  mentor
}

enum RequestStatus {
  pending
  approved
  rejected
}

enum BookingStatus {
  pending
  confirmed
  rejected
  cancelled
}

enum LocationType {
  online
  in_person
}

